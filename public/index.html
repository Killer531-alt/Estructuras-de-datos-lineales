<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TaskPro - Sistema Profesional de Gesti√≥n de Tareas</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #f0f2f5 0%, #e6e9f0 100%);
      color: #2c3e50;
      min-height: 100vh;
    }

    .app-container {
      display: flex;
      height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 250px;
      background: #2c3e50;
      color: white;
      padding: 20px 0;
      display: flex;
      flex-direction: column;
    }

    .logo {
      padding: 0 20px 20px;
      border-bottom: 1px solid #34495e;
      margin-bottom: 20px;
    }

    .logo h2 {
      font-size: 1.5rem;
      display: flex;
      align-items: center;
    }

    .logo i {
      margin-right: 10px;
    }

    .nav-item {
      padding: 12px 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      transition: background 0.2s;
    }

    .nav-item:hover {
      background: #34495e;
    }

    .nav-item.active {
      background: #3498db;
    }

    .nav-item i {
      margin-right: 10px;
      width: 20px;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .top-bar {
      background: white;
      padding: 15px 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .search-bar {
      position: relative;
      width: 300px;
    }

    .search-bar input {
      width: 100%;
      padding: 10px 15px 10px 40px;
      border-radius: 20px;
      border: 1px solid #ddd;
      outline: none;
    }

    .search-bar i {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #7f8c8d;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #3498db;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }

    .content-area {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    .header-section {
      margin-bottom: 25px;
    }

    .header-section h1 {
      font-size: 2rem;
      color: #2c3e50;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      text-align: center;
    }

    .stat-card h3 {
      font-size: 2rem;
      color: #3498db;
    }

    .stat-card p {
      color: #7f8c8d;
    }

    .kanban-board {
      display: flex;
      gap: 20px;
      overflow-x: auto;
      padding: 10px 0;
    }

    .column {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      width: 300px;
      padding: 20px;
      min-height: 400px;
      display: flex;
      flex-direction: column;
    }

    .column.queue { border-left: 5px solid #3498db; }
    .column.stack { border-left: 5px solid #e74c3c; }
    .column.list { border-left: 5px solid #2ecc71; }

    .column-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .column-title {
      font-weight: 600;
      font-size: 1.2rem;
    }

    .task-count {
      background: #ecf0f1;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.9rem;
    }

    .task {
      background: #f8f9fa;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      border-left: 4px solid;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .task:hover {
      transform: translateY(-2px);
    }

    .task.queue-task { border-left-color: #3498db; }
    .task.stack-task { border-left-color: #e74c3c; }
    .task.list-task { border-left-color: #2ecc71; }

    .task-title {
      font-weight: 500;
      margin-bottom: 5px;
    }

    .task-meta {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      color: #7f8c8d;
    }

    .priority-high { color: #e74c3c; }
    .priority-medium { color: #f39c12; }
    .priority-low { color: #2ecc71; }

    .task-actions {
      display: flex;
      gap: 5px;
      margin-top: 8px;
    }

    .btn-move {
      background: #3498db;
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .btn-move:hover {
      background: #2980b9;
    }

    .btn-delete {
      background: #e74c3c;
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .btn-delete:hover {
      background: #c0392b;
    }

    .input-form {
      margin-top: 15px;
    }

    .input-form input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      margin-bottom: 10px;
    }

    .btn {
      background: #3498db;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      width: 100%;
    }

    .btn:hover {
      background: #2980b9;
    }

    .btn-danger {
      background: #e74c3c;
    }

    .btn-danger:hover {
      background: #c0392b;
    }

    .btn-success {
      background: #2ecc71;
    }

    .btn-success:hover {
      background: #27ae60;
    }

    /* P√°ginas ocultas */
    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    .calendar, .stats-page, .config-page, .projects-page {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
    }

    .calendar-day {
      padding: 10px;
      text-align: center;
      border: 1px solid #eee;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .config-item {
      padding: 15px;
      border-bottom: 1px solid #eee;
    }

    .project-card {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .project-actions {
      display: flex;
      gap: 5px;
    }

    .project-actions button {
      padding: 4px 8px;
      font-size: 0.8rem;
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
    }

    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background-color: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-header h2 {
      color: #2c3e50;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #7f8c8d;
    }

    .close-btn:hover {
      color: #2c3e50;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #2c3e50;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-family: 'Inter', sans-serif;
      font-size: 1rem;
    }

    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    .priority-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      margin-right: 5px;
    }

    .priority-critical {
      background: #e74c3c;
      color: white;
    }

    .priority-high-badge {
      background: #e67e22;
      color: white;
    }

    .priority-medium-badge {
      background: #f39c12;
      color: white;
    }

    .priority-low-badge {
      background: #2ecc71;
      color: white;
    }

    .user-badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 4px 10px;
      background: #ecf0f1;
      border-radius: 16px;
      font-size: 0.85rem;
      margin-right: 5px;
    }

    .user-avatar-small {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 0.8rem;
    }

    .task-extended {
      background: white;
      border: 1px solid #ddd;
      padding: 15px;
      margin-bottom: 12px;
      border-radius: 8px;
      border-left: 4px solid;
      cursor: pointer;
      transition: all 0.3s;
    }

    .task-extended:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transform: translateY(-2px);
    }

    .task-extended-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 10px;
    }

    .task-extended-title {
      font-weight: 600;
      flex: 1;
      color: #2c3e50;
    }

    .task-extended-meta {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      font-size: 0.85rem;
      margin-bottom: 8px;
    }

    .status-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .status-pending {
      background: #3498db;
      color: white;
    }

    .status-in-progress {
      background: #f39c12;
      color: white;
    }

    .status-completed {
      background: #2ecc71;
      color: white;
    }

    .status-blocked {
      background: #e74c3c;
      color: white;
    }

    .filters-container {
      background: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .filter-select {
      display: flex;
      flex-direction: column;
    }

    .filter-select label {
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 5px;
      color: #2c3e50;
    }

    .filter-select select {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-family: 'Inter', sans-serif;
    }

    .btn-filter-reset {
      align-self: flex-end;
      background: #95a5a6;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .btn-filter-reset:hover {
      background: #7f8c8d;
    }

    .team-members {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .team-member-select {
      padding: 4px 8px;
      background: #ecf0f1;
      border: 1px solid #bdc3c7;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85rem;
    }

    .team-member-select.selected {
      background: #3498db;
      color: white;
      border-color: #2980b9;
    }

    .task-actions-extended {
      display: flex;
      gap: 5px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .btn-sm {
      padding: 6px 10px;
      font-size: 0.8rem;
    }

    .stats-dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    .stat-card-large {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    .stat-card-large h4 {
      color: #7f8c8d;
      font-size: 0.9rem;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .stat-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: #3498db;
    }

    .stat-chart {
      margin-top: 15px;
      height: 100px;
      background: #f8f9fa;
      border-radius: 6px;
      display: flex;
      align-items: flex-end;
      gap: 3px;
      padding: 10px;
    }

    .chart-bar {
      flex: 1;
      background: #3498db;
      border-radius: 3px;
      min-height: 10px;
    }

    .user-list {
      max-height: 400px;
      overflow-y: auto;
    }

    .user-item {
      padding: 10px;
      border-bottom: 1px solid #eee;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .user-info-inline {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .delete-user-btn {
      background: #e74c3c;
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.75rem;
    }

    .delete-user-btn:hover {
      background: #c0392b;
    }

    .task-description {
      color: #7f8c8d;
      font-size: 0.9rem;
      margin: 8px 0;
      line-height: 1.4;
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #7f8c8d;
    }

    .empty-state i {
      font-size: 3rem;
      margin-bottom: 15px;
      color: #bdc3c7;
    }

    .column-queue { border-left: 5px solid #3498db; }
    .column-stack { border-left: 5px solid #e74c3c; }
    .column-list { border-left: 5px solid #2ecc71; }
    .column-blocked { border-left: 5px solid #95a5a6; }

    .priority-queue-btn {
      background: #9b59b6;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 6px;
      cursor: pointer;
      margin-bottom: 10px;
      font-weight: 500;
    }

    .priority-queue-btn:hover {
      background: #8e44ad;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="logo">
        <h2><i class="fas fa-tasks"></i> TaskPro</h2>
      </div>
      <div class="nav-item active" data-page="dashboard">
        <i class="fas fa-home"></i> Dashboard
      </div>
      <div class="nav-item" data-page="board">
        <i class="fas fa-th"></i> Tablero
      </div>
      <div class="nav-item" data-page="projects">
        <i class="fas fa-folder"></i> Proyectos
      </div>
      <div class="nav-item" data-page="team">
        <i class="fas fa-users"></i> Equipo
      </div>
      <div class="nav-item" data-page="reports">
        <i class="fas fa-chart-bar"></i> Reportes
      </div>
      <div class="nav-item" data-page="settings">
        <i class="fas fa-cog"></i> Configuraci√≥n
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="top-bar">
        <div class="search-bar">
          <i class="fas fa-search"></i>
          <input type="text" placeholder="Buscar tareas..." id="search-input" oninput="performSearch()">
        </div>
        <div class="user-info">
          <div class="avatar" id="current-user-avatar">JD</div>
          <span id="current-user-name">John Doe</span>
        </div>
      </div>

      <div class="content-area">
        <!-- Dashboard -->
        <div id="dashboard-page" class="page active">
          <div class="header-section">
            <h1>üìä Dashboard</h1>
            <p>Visi√≥n general de tu gesti√≥n de tareas</p>
          </div>

          <div class="stats-dashboard">
            <div class="stat-card-large">
              <h4>Total de Tareas</h4>
              <div class="stat-value" id="total-tasks">0</div>
              <div class="stat-chart" id="chart-total"></div>
            </div>
            <div class="stat-card-large">
              <h4>Tareas por Prioridad</h4>
              <div id="priority-stats"></div>
            </div>
            <div class="stat-card-large">
              <h4>Por Usuario</h4>
              <div id="user-stats"></div>
            </div>
            <div class="stat-card-large">
              <h4>Por Estado</h4>
              <div id="status-stats"></div>
            </div>
          </div>

          <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
            <h3>Pr√≥ximas Tareas (Por Prioridad)</h3>
            <div id="upcoming-tasks"></div>
          </div>
        </div>

        <!-- Tablero Kanban -->
        <div id="board-page" class="page">
          <div class="header-section">
            <h1>üìã Tablero de Tareas</h1>
            <p>Gestiona tus tareas por estado</p>
          </div>

          <div class="filters-container">
            <div class="filter-select">
              <label>Proyecto</label>
              <select id="filter-project" onchange="applyFilters()">
                <option value="">Todos</option>
              </select>
            </div>
            <div class="filter-select">
              <label>Usuario Asignado</label>
              <select id="filter-user" onchange="applyFilters()">
                <option value="">Todos</option>
              </select>
            </div>
            <div class="filter-select">
              <label>Prioridad</label>
              <select id="filter-priority" onchange="applyFilters()">
                <option value="">Todas</option>
                <option value="critical">Cr√≠tica</option>
                <option value="high">Alta</option>
                <option value="medium">Media</option>
                <option value="low">Baja</option>
              </select>
            </div>
            <div class="filter-select">
              <label>Estado</label>
              <select id="filter-status" onchange="applyFilters()">
                <option value="">Todos</option>
                <option value="pending">Pendiente</option>
                <option value="in-progress">En Progreso</option>
                <option value="completed">Completada</option>
                <option value="blocked">Bloqueada</option>
              </select>
            </div>
            <button class="btn-filter-reset" onclick="resetFilters()">Limpiar Filtros</button>
          </div>

          <button class="priority-queue-btn" onclick="showPriorityQueue()">
            <i class="fas fa-star"></i> Ver Cola de Prioridad
          </button>

          <div class="kanban-board">
            <div class="column queue-column">
              <div class="column-header">
                <div class="column-title">üìã Pendientes</div>
                <div class="task-count" id="pending-count">0</div>
              </div>
              <div id="pending-list" class="task-list"></div>
              <div class="input-form">
                <input type="text" id="input-task" placeholder="Nueva tarea...">
                <button class="btn" onclick="openNewTaskModal('pending')">+ Agregar Tarea</button>
              </div>
            </div>

            <div class="column stack-column">
              <div class="column-header">
                <div class="column-title">üî• En Progreso</div>
                <div class="task-count" id="progress-count">0</div>
              </div>
              <div id="progress-list" class="task-list"></div>
            </div>

            <div class="column list-column">
              <div class="column-header">
                <div class="column-title">‚úÖ Completadas</div>
                <div class="task-count" id="done-count">0</div>
              </div>
              <div id="done-list" class="task-list"></div>
            </div>

            <div class="column blocked-column">
              <div class="column-header">
                <div class="column-title">‚õî Bloqueadas</div>
                <div class="task-count" id="blocked-count">0</div>
              </div>
              <div id="blocked-list" class="task-list"></div>
            </div>
          </div>
        </div>

        <!-- Proyectos -->
        <div id="projects-page" class="page">
          <div class="header-section">
            <h1>üìÅ Proyectos</h1>
            <p>Crea y gestiona tus proyectos profesionalmente</p>
          </div>

          <div style="margin-bottom: 20px;">
            <button class="btn" onclick="openNewProjectModal()">
              <i class="fas fa-plus"></i> Nuevo Proyecto
            </button>
          </div>

          <div id="projects-list"></div>
        </div>

        <!-- Equipo -->
        <div id="team-page" class="page">
          <div class="header-section">
            <h1>üë• Equipo</h1>
            <p>Gestiona los miembros de tu equipo</p>
          </div>

          <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
            <h3>Agregar Miembro del Equipo</h3>
            <div style="margin-bottom: 20px;">
              <input type="text" id="new-member-name" placeholder="Nombre del miembro..." style="margin-right: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 6px; width: calc(50% - 55px);">
              <input type="email" id="new-member-email" placeholder="Email..." style="margin-right: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 6px; width: calc(50% - 55px);">
              <button class="btn" onclick="addTeamMember()" style="width: auto;">Agregar</button>
            </div>

            <h3>Miembros del Equipo</h3>
            <div id="team-list" class="user-list"></div>
          </div>
        </div>

        <!-- Reportes -->
        <div id="reports-page" class="page">
          <div class="header-section">
            <h1>üìä Reportes</h1>
            <p>An√°lisis y estad√≠sticas de productividad</p>
          </div>

          <div class="stats-dashboard">
            <div class="stat-card-large">
              <h4>Tareas Completadas</h4>
              <div class="stat-value" id="report-completed">0</div>
              <p style="color: #7f8c8d; font-size: 0.9rem; margin-top: 10px;">Esta semana</p>
            </div>
            <div class="stat-card-large">
              <h4>Tasa de Finalizaci√≥n</h4>
              <div class="stat-value" id="report-completion-rate">0%</div>
              <p style="color: #7f8c8d; font-size: 0.9rem; margin-top: 10px;">General</p>
            </div>
            <div class="stat-card-large">
              <h4>Tiempo Promedio</h4>
              <div class="stat-value" id="report-avg-time">-</div>
              <p style="color: #7f8c8d; font-size: 0.9rem; margin-top: 10px;">Por tarea</p>
            </div>
            <div class="stat-card-large">
              <h4>Tareas Vencidas</h4>
              <div class="stat-value" id="report-overdue">0</div>
              <p style="color: #e74c3c; font-size: 0.9rem; margin-top: 10px;">Requieren atenci√≥n</p>
            </div>
          </div>

          <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-top: 20px;">
            <h3>Tareas por Usuario</h3>
            <div id="user-task-stats"></div>
          </div>
        </div>

        <!-- Configuraci√≥n -->
        <div id="settings-page" class="page">
          <div class="header-section">
            <h1>‚öôÔ∏è Configuraci√≥n</h1>
            <p>Personaliza tu experiencia</p>
          </div>

          <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
            <div class="config-item">
              <h3>Usuario Actual</h3>
              <input type="text" id="current-user-input" placeholder="Tu nombre..." style="padding: 10px; border: 1px solid #ddd; border-radius: 6px; width: 100%; margin-bottom: 10px;">
              <button class="btn" onclick="updateCurrentUser()" style="width: auto;">Actualizar</button>
            </div>
            <div class="config-item" style="margin-top: 20px;">
              <h3>Datos</h3>
              <button class="btn btn-danger" onclick="clearAllData()" style="width: auto;">Limpiar Todos los Datos</button>
              <p style="color: #7f8c8d; font-size: 0.85rem; margin-top: 10px;">‚ö†Ô∏è Esta acci√≥n no se puede deshacer</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para Nueva Tarea -->
  <div id="task-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Nueva Tarea</h2>
        <button class="close-btn" onclick="closeTaskModal()">&times;</button>
      </div>
      <div class="form-group">
        <label>T√≠tulo</label>
        <input type="text" id="task-title" placeholder="T√≠tulo de la tarea">
      </div>
      <div class="form-group">
        <label>Descripci√≥n</label>
        <textarea id="task-description" placeholder="Descripci√≥n detallada..."></textarea>
      </div>
      <div class="form-group">
        <label>Proyecto</label>
        <select id="task-project">
          <option value="">Sin proyecto</option>
        </select>
      </div>
      <div class="form-group">
        <label>Prioridad</label>
        <select id="task-priority">
          <option value="low">Baja</option>
          <option value="medium" selected>Media</option>
          <option value="high">Alta</option>
          <option value="critical">Cr√≠tica</option>
        </select>
      </div>
      <div class="form-group">
        <label>Asignar a Usuario</label>
        <select id="task-assignee">
          <option value="">Sin asignar</option>
        </select>
      </div>
      <div class="form-group">
        <label>Fecha de Vencimiento</label>
        <input type="date" id="task-due-date">
      </div>
      <div style="display: flex; gap: 10px;">
        <button class="btn" onclick="saveTask()" style="flex: 1;">Guardar Tarea</button>
        <button class="btn btn-danger" onclick="closeTaskModal()" style="flex: 1;">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Modal para Editar Tarea -->
  <div id="edit-task-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Editar Tarea</h2>
        <button class="close-btn" onclick="closeEditTaskModal()">&times;</button>
      </div>
      <div class="form-group">
        <label>T√≠tulo</label>
        <input type="text" id="edit-task-title" placeholder="T√≠tulo de la tarea">
      </div>
      <div class="form-group">
        <label>Descripci√≥n</label>
        <textarea id="edit-task-description" placeholder="Descripci√≥n detallada..."></textarea>
      </div>
      <div class="form-group">
        <label>Proyecto</label>
        <select id="edit-task-project">
          <option value="">Sin proyecto</option>
        </select>
      </div>
      <div class="form-group">
        <label>Prioridad</label>
        <select id="edit-task-priority">
          <option value="low">Baja</option>
          <option value="medium">Media</option>
          <option value="high">Alta</option>
          <option value="critical">Cr√≠tica</option>
        </select>
      </div>
      <div class="form-group">
        <label>Estado</label>
        <select id="edit-task-status">
          <option value="pending">Pendiente</option>
          <option value="in-progress">En Progreso</option>
          <option value="completed">Completada</option>
          <option value="blocked">Bloqueada</option>
        </select>
      </div>
      <div class="form-group">
        <label>Asignar a Usuario</label>
        <select id="edit-task-assignee">
          <option value="">Sin asignar</option>
        </select>
      </div>
      <div class="form-group">
        <label>Fecha de Vencimiento</label>
        <input type="date" id="edit-task-due-date">
      </div>
      <div style="display: flex; gap: 10px;">
        <button class="btn" onclick="updateTask()" style="flex: 1;">Guardar Cambios</button>
        <button class="btn btn-danger" onclick="deleteEditingTask()" style="flex: 1;">Eliminar</button>
        <button class="btn btn-danger" onclick="closeEditTaskModal()" style="flex: 1;">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Modal para Nuevo Proyecto -->
  <div id="project-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Nuevo Proyecto</h2>
        <button class="close-btn" onclick="closeProjectModal()">&times;</button>
      </div>
      <div class="form-group">
        <label>Nombre del Proyecto</label>
        <input type="text" id="project-name" placeholder="Nombre...">
      </div>
      <div class="form-group">
        <label>Descripci√≥n</label>
        <textarea id="project-description" placeholder="Describe tu proyecto..."></textarea>
      </div>
      <div class="form-group">
        <label>Fecha de Inicio</label>
        <input type="date" id="project-start-date">
      </div>
      <div class="form-group">
        <label>Fecha de Cierre Estimada</label>
        <input type="date" id="project-end-date">
      </div>
      <div class="form-group">
        <label>Equipo (Selecciona miembros)</label>
        <div id="project-team-select" class="team-members"></div>
      </div>
      <div style="display: flex; gap: 10px;">
        <button class="btn" onclick="saveProject()" style="flex: 1;">Crear Proyecto</button>
        <button class="btn btn-danger" onclick="closeProjectModal()" style="flex: 1;">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Modal para Cola de Prioridad -->
  <div id="priority-queue-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Cola de Prioridad (Ordenadas por Importancia)</h2>
        <button class="close-btn" onclick="closePriorityQueueModal()">&times;</button>
      </div>
      <div id="priority-queue-list"></div>
      <button class="btn" onclick="closePriorityQueueModal()" style="width: 100%; margin-top: 20px;">Cerrar</button>
    </div>
  </div>

  <script>
    // ==================== HEAP - COLA DE PRIORIDAD ====================
    class MinHeap {
      constructor() {
        this.heap = [];
      }

      getParentIndex(i) { return Math.floor((i - 1) / 2); }
      getLeftChild(i) { return 2 * i + 1; }
      getRightChild(i) { return 2 * i + 2; }

      swap(i, j) {
        [this.heap[i], this.heap[j]] = [this.heap[j], this.heap[i]];
      }

      push(task) {
        this.heap.push(task);
        this.bubbleUp(this.heap.length - 1);
      }

      bubbleUp(index) {
        while (index > 0) {
          const parentIndex = this.getParentIndex(index);
          if (this.compareTasks(this.heap[index], this.heap[parentIndex]) < 0) {
            this.swap(index, parentIndex);
            index = parentIndex;
          } else break;
        }
      }

      pop() {
        if (this.heap.length === 0) return null;
        if (this.heap.length === 1) return this.heap.pop();
        const min = this.heap[0];
        this.heap[0] = this.heap.pop();
        this.bubbleDown(0);
        return min;
      }

      bubbleDown(index) {
        while (true) {
          let smallest = index;
          const left = this.getLeftChild(index);
          const right = this.getRightChild(index);

          if (left < this.heap.length && this.compareTasks(this.heap[left], this.heap[smallest]) < 0) {
            smallest = left;
          }
          if (right < this.heap.length && this.compareTasks(this.heap[right], this.heap[smallest]) < 0) {
            smallest = right;
          }

          if (smallest !== index) {
            this.swap(index, smallest);
            index = smallest;
          } else break;
        }
      }

      compareTasks(a, b) {
        const priorityOrder = { critical: 0, high: 1, medium: 2, low: 3 };
        const aPriority = priorityOrder[a.priority] || 2;
        const bPriority = priorityOrder[b.priority] || 2;

        if (aPriority !== bPriority) return aPriority - bPriority;

        if (a.dueDate && b.dueDate) {
          return new Date(a.dueDate) - new Date(b.dueDate);
        }
        return 0;
      }

      toArray() {
        return [...this.heap].sort((a, b) => this.compareTasks(a, b));
      }

      isEmpty() {
        return this.heap.length === 0;
      }
    }

    // ==================== DATOS GLOBALES ====================
    let currentUser = localStorage.getItem('currentUser') || 'John Doe';
    let teamMembers = JSON.parse(localStorage.getItem('teamMembers')) || [
      { id: '1', name: 'John Doe', email: 'john@example.com', initials: 'JD', color: '#3498db' },
      { id: '2', name: 'Jane Smith', email: 'jane@example.com', initials: 'JS', color: '#e74c3c' },
      { id: '3', name: 'Bob Wilson', email: 'bob@example.com', initials: 'BW', color: '#2ecc71' }
    ];

    let projects = JSON.parse(localStorage.getItem('projects')) || {
      'default': {
        id: 'default',
        name: 'Proyecto Principal',
        description: 'Proyecto por defecto',
        startDate: new Date().toISOString().split('T')[0],
        endDate: '',
        team: ['1', '2', '3'],
        tasks: []
      }
    };

    let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
    let currentProjectId = localStorage.getItem('currentProjectId') || 'default';
    let editingTaskId = null;
    let filters = { project: '', user: '', priority: '', status: '' };

    // ==================== INICIALIZACI√ìN ====================
    window.addEventListener('load', () => {
      updateUIWithCurrentUser();
      populateProjectSelects();
      populateUserSelects();
      renderBoard();
      updateDashboard();
      renderProjectsList();
      renderTeamList();
      updateReports();
    });

    // ==================== USUARIO ACTUAL ====================
    function updateUIWithCurrentUser() {
      const user = teamMembers.find(m => m.name === currentUser);
      if (user) {
        document.getElementById('current-user-avatar').textContent = user.initials;
        document.getElementById('current-user-avatar').style.backgroundColor = user.color;
      }
      document.getElementById('current-user-name').textContent = currentUser;
      document.getElementById('current-user-input').value = currentUser;
    }

    function updateCurrentUser() {
      const newName = document.getElementById('current-user-input').value.trim();
      if (newName) {
        currentUser = newName;
        localStorage.setItem('currentUser', currentUser);
        updateUIWithCurrentUser();
        alert('Usuario actualizado');
      }
    }

    // ==================== PROYECTOS ====================
    function openNewProjectModal() {
      document.getElementById('project-modal').classList.add('active');
      populateProjectTeamSelect();
    }

    function closeProjectModal() {
      document.getElementById('project-modal').classList.remove('active');
    }

    function populateProjectTeamSelect() {
      const container = document.getElementById('project-team-select');
      container.innerHTML = '';
      teamMembers.forEach(member => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'team-member-select selected';
        btn.textContent = member.name;
        btn.onclick = () => btn.classList.toggle('selected');
        container.appendChild(btn);
      });
    }

    function saveProject() {
      const name = document.getElementById('project-name').value.trim();
      const description = document.getElementById('project-description').value.trim();
      const startDate = document.getElementById('project-start-date').value;
      const endDate = document.getElementById('project-end-date').value;

      if (!name) {
        alert('Por favor ingresa un nombre');
        return;
      }

      const selected = Array.from(document.querySelectorAll('#project-team-select .team-member-select.selected'))
        .map(btn => teamMembers.find(m => m.name === btn.textContent).id);

      const id = Date.now().toString();
      projects[id] = {
        id,
        name,
        description,
        startDate: startDate || new Date().toISOString().split('T')[0],
        endDate,
        team: selected,
        tasks: []
      };

      saveData();
      closeProjectModal();
      renderProjectsList();
      populateProjectSelects();
      updateDashboard();
      renderBoard();
      alert('Proyecto creado exitosamente');
    }

    function renderProjectsList() {
      const container = document.getElementById('projects-list');
      container.innerHTML = '';

      Object.values(projects).forEach(project => {
        const div = document.createElement('div');
        div.className = 'project-card';
        const projectTasks = tasks.filter(t => t.projectId === project.id);
        const completed = projectTasks.filter(t => t.status === 'completed').length;

        div.innerHTML = `
          <div>
            <h3>${project.name}</h3>
            <p>${project.description || 'Sin descripci√≥n'}</p>
            <p style="color: #7f8c8d; font-size: 0.85rem;">
              <i class="fas fa-tasks"></i> ${projectTasks.length} tareas | 
              <i class="fas fa-check"></i> ${completed} completadas |
              <i class="fas fa-calendar"></i> ${project.startDate}
            </p>
            <p style="font-size: 0.85rem; margin-top: 5px;">
              Equipo: ${project.team.map(uid => teamMembers.find(m => m.id === uid)?.name || '?').join(', ')}
            </p>
          </div>
          <div class="project-actions">
            <button class="btn btn-sm" onclick="switchToProject('${project.id}')">Abrir</button>
            ${project.id !== 'default' ? `<button class="btn btn-danger btn-sm" onclick="deleteProject('${project.id}')">Eliminar</button>` : ''}
          </div>
        `;
        container.appendChild(div);
      });
    }

    function switchToProject(projectId) {
      currentProjectId = projectId;
      localStorage.setItem('currentProjectId', projectId);
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById('board-page').classList.add('active');
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      document.querySelector('.nav-item[data-page="board"]').classList.add('active');
      renderBoard();
    }

    function deleteProject(projectId) {
      if (confirm('¬øEliminar este proyecto?')) {
        delete projects[projectId];
        tasks = tasks.filter(t => t.projectId !== projectId);
        saveData();
        renderProjectsList();
        populateProjectSelects();
        renderBoard();
        updateDashboard();
        updateReports();
      }
    }

    // ==================== EQUIPO ====================
    function addTeamMember() {
      const name = document.getElementById('new-member-name').value.trim();
      const email = document.getElementById('new-member-email').value.trim();

      if (!name || !email) {
        alert('Por favor completa todos los campos');
        return;
      }

      const initials = name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
      const colors = ['#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6', '#1abc9c'];
      const color = colors[teamMembers.length % colors.length];

      const member = {
        id: Date.now().toString(),
        name,
        email,
        initials,
        color
      };

      teamMembers.push(member);
      saveData();
      document.getElementById('new-member-name').value = '';
      document.getElementById('new-member-email').value = '';
      renderTeamList();
      populateUserSelects();
      populateProjectSelects();
      updateDashboard();
      updateReports();
    }

    function renderTeamList() {
      const container = document.getElementById('team-list');
      container.innerHTML = '';

      teamMembers.forEach(member => {
        const div = document.createElement('div');
        div.className = 'user-item';
        const memberTasks = tasks.filter(t => t.assignee === member.id);

        div.innerHTML = `
          <div class="user-info-inline">
            <div class="user-avatar-small" style="background: ${member.color};">
              ${member.initials}
            </div>
            <div>
              <div style="font-weight: 600;">${member.name}</div>
              <div style="color: #7f8c8d; font-size: 0.85rem;">${member.email}</div>
              <div style="color: #3498db; font-size: 0.85rem;">${memberTasks.length} tareas asignadas</div>
            </div>
          </div>
          ${teamMembers.length > 1 ? `<button class="delete-user-btn" onclick="deleteTeamMember('${member.id}')">Eliminar</button>` : ''}
        `;
        container.appendChild(div);
      });
    }

    function deleteTeamMember(memberId) {
      if (confirm('¬øEliminar este miembro?')) {
        teamMembers = teamMembers.filter(m => m.id !== memberId);
        tasks = tasks.map(t => t.assignee === memberId ? { ...t, assignee: '' } : t);
        Object.values(projects).forEach(p => {
          p.team = p.team.filter(id => id !== memberId);
        });
        saveData();
        renderTeamList();
        populateUserSelects();
        populateProjectSelects();
        renderBoard();
        updateDashboard();
        updateReports();
      }
    }

    // ==================== TAREAS ====================
    function openNewTaskModal(status = 'pending') {
      editingTaskId = null;
      document.getElementById('task-title').value = '';
      document.getElementById('task-description').value = '';
      document.getElementById('task-project').value = currentProjectId;
      document.getElementById('task-priority').value = 'medium';
      document.getElementById('task-assignee').value = '';
      document.getElementById('task-due-date').value = '';
      document.getElementById('task-modal').classList.add('active');
    }

    function closeTaskModal() {
      document.getElementById('task-modal').classList.remove('active');
    }

    function saveTask() {
      const title = document.getElementById('task-title').value.trim();
      const description = document.getElementById('task-description').value.trim();
      const projectId = document.getElementById('task-project').value || 'default';
      const priority = document.getElementById('task-priority').value;
      const assignee = document.getElementById('task-assignee').value || '';
      const dueDate = document.getElementById('task-due-date').value || '';

      if (!title) {
        alert('Por favor ingresa un t√≠tulo');
        return;
      }

      const task = {
        id: Date.now().toString(),
        title,
        description,
        projectId,
        priority,
        assignee,
        dueDate,
        status: 'pending',
        createdAt: new Date().toISOString(),
        completedAt: null
      };

      tasks.push(task);
      saveData();
      closeTaskModal();
      renderBoard();
      updateDashboard();
      updateReports();
    }

    function openEditTaskModal(taskId) {
      const task = tasks.find(t => t.id === taskId);
      if (!task) return;

      editingTaskId = taskId;
      document.getElementById('edit-task-title').value = task.title;
      document.getElementById('edit-task-description').value = task.description;
      document.getElementById('edit-task-project').value = task.projectId;
      document.getElementById('edit-task-priority').value = task.priority;
      document.getElementById('edit-task-status').value = task.status;
      document.getElementById('edit-task-assignee').value = task.assignee;
      document.getElementById('edit-task-due-date').value = task.dueDate;
      document.getElementById('edit-task-modal').classList.add('active');
    }

    function closeEditTaskModal() {
      document.getElementById('edit-task-modal').classList.remove('active');
      editingTaskId = null;
    }

    function updateTask() {
      if (!editingTaskId) return;

      const task = tasks.find(t => t.id === editingTaskId);
      if (!task) return;

      task.title = document.getElementById('edit-task-title').value.trim();
      task.description = document.getElementById('edit-task-description').value.trim();
      task.projectId = document.getElementById('edit-task-project').value || 'default';
      task.priority = document.getElementById('edit-task-priority').value;
      task.status = document.getElementById('edit-task-status').value;
      task.assignee = document.getElementById('edit-task-assignee').value || '';
      task.dueDate = document.getElementById('edit-task-due-date').value || '';

      if (task.status === 'completed' && !task.completedAt) {
        task.completedAt = new Date().toISOString();
      } else if (task.status !== 'completed') {
        task.completedAt = null;
      }

      saveData();
      closeEditTaskModal();
      renderBoard();
      updateDashboard();
      updateReports();
    }

    function deleteEditingTask() {
      if (editingTaskId && confirm('¬øEliminar esta tarea?')) {
        tasks = tasks.filter(t => t.id !== editingTaskId);
        saveData();
        closeEditTaskModal();
        renderBoard();
        updateDashboard();
        updateReports();
      }
    }

    function changeTaskStatus(taskId, newStatus) {
      const task = tasks.find(t => t.id === taskId);
      if (task) {
        task.status = newStatus;
        if (newStatus === 'completed' && !task.completedAt) {
          task.completedAt = new Date().toISOString();
        } else if (newStatus !== 'completed') {
          task.completedAt = null;
        }
        saveData();
        renderBoard();
        updateDashboard();
        updateReports();
      }
    }

    // ==================== TABLERO KANBAN ====================
    function renderBoard() {
      const projectTasks = tasks.filter(t => t.projectId === currentProjectId);
      const filteredTasks = applyFiltersToTasks(projectTasks);

      renderTaskList(filteredTasks.filter(t => t.status === 'pending'), 'pending-list');
      renderTaskList(filteredTasks.filter(t => t.status === 'in-progress'), 'progress-list');
      renderTaskList(filteredTasks.filter(t => t.status === 'completed'), 'done-list');
      renderTaskList(filteredTasks.filter(t => t.status === 'blocked'), 'blocked-list');

      document.getElementById('pending-count').textContent = filteredTasks.filter(t => t.status === 'pending').length;
      document.getElementById('progress-count').textContent = filteredTasks.filter(t => t.status === 'in-progress').length;
      document.getElementById('done-count').textContent = filteredTasks.filter(t => t.status === 'completed').length;
      document.getElementById('blocked-count').textContent = filteredTasks.filter(t => t.status === 'blocked').length;
    }

    function renderTaskList(taskList, elementId) {
      const container = document.getElementById(elementId);
      container.innerHTML = '';

      if (taskList.length === 0) {
        container.innerHTML = '<div class="empty-state"><i class="fas fa-inbox"></i><p>Sin tareas</p></div>';
        return;
      }

      taskList.sort((a, b) => {
        const priorityOrder = { critical: 0, high: 1, medium: 2, low: 3 };
        return (priorityOrder[a.priority] || 2) - (priorityOrder[b.priority] || 2);
      });

      taskList.forEach(task => {
        const div = document.createElement('div');
        div.className = `task-extended status-${task.status}`;
        div.style.borderLeftColor = getPriorityColor(task.priority);

        const assignee = task.assignee ? teamMembers.find(m => m.id === task.assignee) : null;
        const project = projects[task.projectId];

        let html = `
          <div class="task-extended-header">
            <div class="task-extended-title">${task.title}</div>
            <div style="display: flex; gap: 5px;">
              <select onchange="changeTaskStatus('${task.id}', this.value)" style="padding: 4px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.85rem;">
                <option value="pending" ${task.status === 'pending' ? 'selected' : ''}>Pendiente</option>
                <option value="in-progress" ${task.status === 'in-progress' ? 'selected' : ''}>En Progreso</option>
                <option value="completed" ${task.status === 'completed' ? 'selected' : ''}>Completada</option>
                <option value="blocked" ${task.status === 'blocked' ? 'selected' : ''}>Bloqueada</option>
              </select>
            </div>
          </div>
          <div class="task-extended-meta">
            <span class="priority-badge priority-${getPriorityClass(task.priority)}">${task.priority.toUpperCase()}</span>
            ${task.dueDate ? `<span style="color: #7f8c8d; font-size: 0.85rem;"><i class="fas fa-calendar"></i> ${task.dueDate}</span>` : ''}
            ${project ? `<span style="background: #ecf0f1; padding: 2px 6px; border-radius: 4px; font-size: 0.85rem;">${project.name}</span>` : ''}
          </div>
          ${assignee ? `<div class="user-badge"><div class="user-avatar-small" style="background: ${assignee.color};">${assignee.initials}</div> ${assignee.name}</div>` : ''}
          ${task.description ? `<div class="task-description">${task.description}</div>` : ''}
          <div class="task-actions-extended">
            <button class="btn-move btn-sm" onclick="openEditTaskModal('${task.id}')">Editar</button>
            <button class="btn-delete btn-sm" onclick="deleteEditingTask()" style="background: #e74c3c; color: white; border: none; padding: 6px 10px; border-radius: 4px; font-size: 0.8rem; cursor: pointer;">Eliminar</button>
          </div>
        `;

        div.innerHTML = html;
        container.appendChild(div);
      });
    }

    // ==================== COLA DE PRIORIDAD ====================
    function showPriorityQueue() {
      const projectTasks = tasks.filter(t => t.projectId === currentProjectId && t.status !== 'completed');
      const heap = new MinHeap();

      projectTasks.forEach(task => heap.push(task));
      const prioritized = heap.toArray();

      const container = document.getElementById('priority-queue-list');
      container.innerHTML = '';

      if (prioritized.length === 0) {
        container.innerHTML = '<div class="empty-state"><p>No hay tareas pendientes</p></div>';
      } else {
        prioritized.forEach((task, index) => {
          const div = document.createElement('div');
          div.className = 'task-extended';
          div.style.borderLeftColor = getPriorityColor(task.priority);
          div.style.marginBottom = '10px';

          const assignee = task.assignee ? teamMembers.find(m => m.id === task.assignee) : null;

          div.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: start;">
              <div>
                <div style="font-weight: 700; color: #3498db; margin-bottom: 5px;">Prioridad #${index + 1}</div>
                <div class="task-extended-title">${task.title}</div>
              </div>
              <span class="priority-badge priority-${getPriorityClass(task.priority)}">${task.priority.toUpperCase()}</span>
            </div>
            <div class="task-extended-meta" style="margin-top: 10px;">
              ${task.dueDate ? `<span><i class="fas fa-calendar"></i> ${task.dueDate}</span>` : ''}
              <span class="status-badge status-${task.status}">${task.status.toUpperCase()}</span>
              ${assignee ? `<div class="user-badge"><div class="user-avatar-small" style="background: ${assignee.color};">${assignee.initials}</div>${assignee.name}</div>` : '<span style="color: #95a5a6;">Sin asignar</span>'}
            </div>
          `;
          container.appendChild(div);
        });
      }

      document.getElementById('priority-queue-modal').classList.add('active');
    }

    function closePriorityQueueModal() {
      document.getElementById('priority-queue-modal').classList.remove('active');
    }

    // ==================== FILTROS ====================
    function populateProjectSelects() {
      const selects = document.querySelectorAll('[id$="-project"]');
      selects.forEach(select => {
        select.innerHTML = '<option value="">Sin proyecto</option>';
        Object.values(projects).forEach(project => {
          const option = document.createElement('option');
          option.value = project.id;
          option.textContent = project.name;
          select.appendChild(option);
        });
      });

      const filterSelect = document.getElementById('filter-project');
      if (filterSelect) {
        filterSelect.innerHTML = '<option value="">Todos</option>';
        Object.values(projects).forEach(project => {
          const option = document.createElement('option');
          option.value = project.id;
          option.textContent = project.name;
          filterSelect.appendChild(option);
        });
      }
    }

    function populateUserSelects() {
      const selects = document.querySelectorAll('[id$="-assignee"]');
      selects.forEach(select => {
        select.innerHTML = '<option value="">Sin asignar</option>';
        teamMembers.forEach(member => {
          const option = document.createElement('option');
          option.value = member.id;
          option.textContent = member.name;
          select.appendChild(option);
        });
      });

      const filterSelect = document.getElementById('filter-user');
      if (filterSelect) {
        filterSelect.innerHTML = '<option value="">Todos</option>';
        teamMembers.forEach(member => {
          const option = document.createElement('option');
          option.value = member.id;
          option.textContent = member.name;
          filterSelect.appendChild(option);
        });
      }
    }

    function applyFilters() {
      filters = {
        project: document.getElementById('filter-project').value || '',
        user: document.getElementById('filter-user').value || '',
        priority: document.getElementById('filter-priority').value || '',
        status: document.getElementById('filter-status').value || ''
      };
      renderBoard();
    }

    function applyFiltersToTasks(taskList) {
      return taskList.filter(task => {
        if (filters.user && task.assignee !== filters.user) return false;
        if (filters.priority && task.priority !== filters.priority) return false;
        if (filters.status && task.status !== filters.status) return false;
        return true;
      });
    }

    function resetFilters() {
      document.getElementById('filter-project').value = '';
      document.getElementById('filter-user').value = '';
      document.getElementById('filter-priority').value = '';
      document.getElementById('filter-status').value = '';
      filters = { project: '', user: '', priority: '', status: '' };
      renderBoard();
    }

    function performSearch() {
      const query = document.getElementById('search-input').value.toLowerCase();
      const projectTasks = tasks.filter(t => t.projectId === currentProjectId);
      const filtered = projectTasks.filter(t =>
        t.title.toLowerCase().includes(query) || 
        t.description.toLowerCase().includes(query)
      );

      renderTaskList(filtered.filter(t => t.status === 'pending'), 'pending-list');
      renderTaskList(filtered.filter(t => t.status === 'in-progress'), 'progress-list');
      renderTaskList(filtered.filter(t => t.status === 'completed'), 'done-list');
      renderTaskList(filtered.filter(t => t.status === 'blocked'), 'blocked-list');
    }

    // ==================== DASHBOARD ====================
    function updateDashboard() {
      const projectTasks = tasks.filter(t => t.projectId === currentProjectId);

      document.getElementById('total-tasks').textContent = projectTasks.length;

      const statsByPriority = { critical: 0, high: 0, medium: 0, low: 0 };
      projectTasks.forEach(t => statsByPriority[t.priority]++);

      let html = `
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
          <div><strong>Cr√≠tica:</strong> ${statsByPriority.critical}</div>
          <div><strong>Alta:</strong> ${statsByPriority.high}</div>
          <div><strong>Media:</strong> ${statsByPriority.medium}</div>
          <div><strong>Baja:</strong> ${statsByPriority.low}</div>
        </div>
      `;
      document.getElementById('priority-stats').innerHTML = html;

      const statsByUser = {};
      teamMembers.forEach(m => statsByUser[m.id] = 0);
      projectTasks.forEach(t => {
        if (t.assignee) statsByUser[t.assignee]++;
      });

      html = '<div style="display: grid; gap: 8px;">';
      Object.entries(statsByUser).forEach(([userId, count]) => {
        const user = teamMembers.find(m => m.id === userId);
        if (user) html += `<div><strong>${user.name}:</strong> ${count}</div>`;
      });
      html += '</div>';
      document.getElementById('user-stats').innerHTML = html;

      const statsByStatus = {
        pending: projectTasks.filter(t => t.status === 'pending').length,
        'in-progress': projectTasks.filter(t => t.status === 'in-progress').length,
        completed: projectTasks.filter(t => t.status === 'completed').length,
        blocked: projectTasks.filter(t => t.status === 'blocked').length
      };

      html = '<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">';
      html += `<div><strong>Pendientes:</strong> ${statsByStatus.pending}</div>`;
      html += `<div><strong>En Progreso:</strong> ${statsByStatus['in-progress']}</div>`;
      html += `<div><strong>Completadas:</strong> ${statsByStatus.completed}</div>`;
      html += `<div><strong>Bloqueadas:</strong> ${statsByStatus.blocked}</div>`;
      html += '</div>';
      document.getElementById('status-stats').innerHTML = html;

      const pendingTasks = projectTasks.filter(t => t.status !== 'completed').sort((a, b) => {
        const priorityOrder = { critical: 0, high: 1, medium: 2, low: 3 };
        return (priorityOrder[a.priority] || 2) - (priorityOrder[b.priority] || 2);
      }).slice(0, 5);

      const container = document.getElementById('upcoming-tasks');
      container.innerHTML = '';
      if (pendingTasks.length === 0) {
        container.innerHTML = '<div class="empty-state"><p>¬°Sin tareas pendientes!</p></div>';
      } else {
        pendingTasks.forEach(task => {
          const assignee = task.assignee ? teamMembers.find(m => m.id === task.assignee) : null;
          const div = document.createElement('div');
          div.className = 'task-extended';
          div.style.borderLeftColor = getPriorityColor(task.priority);
          div.innerHTML = `
            <div style="display: flex; justify-content: space-between;">
              <div style="flex: 1;">
                <div class="task-extended-title">${task.title}</div>
                <div class="task-extended-meta">
                  <span class="priority-badge priority-${getPriorityClass(task.priority)}">${task.priority}</span>
                  ${assignee ? `<div class="user-badge"><div class="user-avatar-small" style="background: ${assignee.color};">${assignee.initials}</div>${assignee.name}</div>` : ''}
                </div>
              </div>
              <button class="btn-move btn-sm" onclick="openEditTaskModal('${task.id}')" style="height: fit-content;">Editar</button>
            </div>
          `;
          container.appendChild(div);
        });
      }
    }

    // ==================== REPORTES ====================
    function updateReports() {
      const projectTasks = tasks.filter(t => t.projectId === currentProjectId);
      const completed = projectTasks.filter(t => t.status === 'completed').length;
      const completionRate = projectTasks.length > 0 ? Math.round((completed / projectTasks.length) * 100) : 0;

      document.getElementById('report-completed').textContent = completed;
      document.getElementById('report-completion-rate').textContent = completionRate + '%';

      const overdue = projectTasks.filter(t => {
        if (!t.dueDate || t.status === 'completed') return false;
        return new Date(t.dueDate) < new Date();
      }).length;
      document.getElementById('report-overdue').textContent = overdue;

      const completedTasks = projectTasks.filter(t => t.completedAt);
      let avgTime = '-';
      if (completedTasks.length > 0) {
        const times = completedTasks.map(t => new Date(t.completedAt) - new Date(t.createdAt));
        const avgMs = times.reduce((a, b) => a + b, 0) / times.length;
        const avgHours = Math.round(avgMs / (1000 * 60 * 60));
        avgTime = avgHours + 'h';
      }
      document.getElementById('report-avg-time').textContent = avgTime;

      const userTaskStats = {};
      teamMembers.forEach(m => {
        const userTasks = projectTasks.filter(t => t.assignee === m.id);
        const userCompleted = userTasks.filter(t => t.status === 'completed').length;
        userTaskStats[m.id] = { completed: userCompleted, total: userTasks.length };
      });

      let html = '<div style="display: grid; gap: 10px;">';
      Object.entries(userTaskStats).forEach(([userId, stats]) => {
        const user = teamMembers.find(m => m.id === userId);
        if (user) {
          const rate = stats.total > 0 ? Math.round((stats.completed / stats.total) * 100) : 0;
          html += `
            <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;">
              <strong>${user.name}:</strong> ${stats.completed}/${stats.total} (${rate}%)
              <div style="height: 6px; background: #ddd; border-radius: 3px; margin-top: 5px; overflow: hidden;">
                <div style="height: 100%; background: #3498db; width: ${rate}%;"></div>
              </div>
            </div>
          `;
        }
      });
      html += '</div>';
      document.getElementById('user-task-stats').innerHTML = html;
    }

    // ==================== UTILIDADES ====================
    function getPriorityColor(priority) {
      const colors = { critical: '#e74c3c', high: '#e67e22', medium: '#f39c12', low: '#2ecc71' };
      return colors[priority] || '#95a5a6';
    }

    function getPriorityClass(priority) {
      if (priority === 'critical') return 'critical';
      if (priority === 'high') return 'high-badge';
      if (priority === 'medium') return 'medium-badge';
      return 'low-badge';
    }

    function saveData() {
      localStorage.setItem('projects', JSON.stringify(projects));
      localStorage.setItem('tasks', JSON.stringify(tasks));
      localStorage.setItem('teamMembers', JSON.stringify(teamMembers));
      localStorage.setItem('currentUser', currentUser);
      localStorage.setItem('currentProjectId', currentProjectId);
      
      // Actualizar todos los selects despu√©s de guardar
      populateProjectSelects();
      populateUserSelects();
    }

    function clearAllData() {
      if (confirm('‚ö†Ô∏è Esta acci√≥n eliminar√° TODOS los datos. ¬øContinuar?')) {
        localStorage.clear();
        location.reload();
      }
    }

    // ==================== NAVEGACI√ìN ====================
    document.querySelectorAll('.nav-item[data-page]').forEach(item => {
      item.addEventListener('click', () => {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

        const page = item.getAttribute('data-page');
        document.getElementById(`${page}-page`).classList.add('active');
        item.classList.add('active');

        if (page === 'dashboard') updateDashboard();
        if (page === 'reports') updateReports();
        if (page === 'board') renderBoard();
        if (page === 'projects') renderProjectsList();
        if (page === 'team') renderTeamList();
      });
    });
  </script>
</body>
</html>